<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SMOKE HUB">
    
    <link rel="apple-touch-icon" href="images/IMG_3689.jpeg">
    <link rel="icon" type="image/png" href="images/IMG_3689.jpeg">
    
    <title>SMOKE HUB | ADMIN PANEL</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    
    <style>
        body {
            margin: 0; font-family: 'Segoe UI', sans-serif;
            background: radial-gradient(circle at top, #1b0b2e, #0b0416);
            color: #fff; display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; padding-bottom: 50px;
            padding-top: env(safe-area-inset-top);
        }
        .logo { display: flex; align-items: center; gap: 10px; margin: 15px 0; }
        .logo-text {
            font-weight: 900; font-size: 26px;
            background: linear-gradient(90deg, #ff0055, #00f2ff, #ff0055);
            background-size: 200% auto; -webkit-background-clip: text;
            -webkit-text-fill-color: transparent; animation: gradient-move 3s linear infinite;
        }
        @keyframes gradient-move { to { background-position: 200% center; } }
        
        .card {
            width: 92%; max-width: 400px; padding: 20px; border-radius: 20px;
            background: rgba(255,255,255,0.07); backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1); box-sizing: border-box;
        }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-box {
            background: rgba(0, 242, 255, 0.05); padding: 10px; border-radius: 12px; text-align: center;
            border: 1px solid rgba(0, 242, 255, 0.2);
        }
        .stat-box b { font-size: 22px; color: #fff; display: block; }
        .stat-box span { font-size: 10px; color: #00f2ff; text-transform: uppercase; }
        
        label { display: block; margin: 12px 0 5px; font-size: 10px; color: #00f2ff; font-weight: bold; text-transform: uppercase; }
        select, input {
            width: 100%; padding: 14px; border-radius: 12px; border: none; 
            background: rgba(255,255,255,0.1); color: #fff; font-size: 16px; outline: none; box-sizing: border-box;
        }
        input::placeholder { color: rgba(255,255,255,0.3); }

        #location-info {
            margin-top: 10px; padding: 10px; border-radius: 12px;
            background: rgba(255, 47, 146, 0.1); border: 1px dashed #ff2f92;
            text-align: center; font-size: 13px; color: #fff; font-weight: bold; display: none;
        }

        .price-display { font-size: 36px; text-align: center; margin: 10px 0; font-weight: 900; text-shadow: 0 0 15px #ff0055; }
        .main-btn {
            width: 100%; padding: 18px; border-radius: 15px; border: none;
            background: linear-gradient(90deg, #ff2f92, #ff005d);
            color: #fff; font-weight: bold; font-size: 18px; cursor: pointer;
        }

        .table-card { width: 92%; max-width: 400px; margin-top: 25px; }
        .section-title { font-size: 11px; color: #666; text-transform: uppercase; margin: 15px 0 8px 5px; letter-spacing: 1px; }

        .top-badge { 
            background: rgba(255, 215, 0, 0.1); border: 1px solid gold; 
            padding: 10px; border-radius: 15px; margin-top: 10px; 
            box-sizing: border-box; width: 100%;
        }

        .order-row {
            background: rgba(255,255,255,0.04); padding: 14px; border-radius: 15px;
            margin-bottom: 8px; border-left: 4px solid #00f2ff;
            display: flex; justify-content: space-between; align-items: center;
        }
        .order-row.debt { border-left-color: #ff9800; background: rgba(255, 152, 0, 0.1); }
        .order-info b { color: #00f2ff; display: block; font-size: 14px; }
        .order-info span { font-size: 11px; color: #888; }
        
        .order-right { display: flex; align-items: center; gap: 12px; }
        .order-price { font-weight: bold; color: #ff2f92; font-size: 16px; }
        
        .action-btn { background: none; border: none; color: #444; cursor: pointer; font-size: 18px; }
        .pay-debt-btn { background: #ff9800; color: #000; border: none; padding: 6px 12px; border-radius: 8px; font-weight: bold; font-size: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <span style="font-size: 30px;">üéÖ</span><span class="logo-text">SMOKE HUB</span>
</div>

<div class="card">
    <div class="stats-grid">
        <div class="stat-box"><span>PLN</span><b id="totalPLN">0</b></div>
        <div class="stat-box"><span>UAH</span><b id="totalUAH">0</b></div>
    </div>

    <label>–ö–∞—Ç–∞–ª–æ–≥</label>
    <select id="catalog" onchange="updateFlavorList()">
        <option value="–∑–∞–ª–∏–≤–∫–∞">–ó–ê–õ–ò–í–ö–ê üß™</option>
        <option value="–ø—Ä–æ–¥–∞–∂">–ü–†–û–î–ê–ñ üì¶</option>
    </select>

    <label>–°—Ç–∞—Ç—É—Å</label>
    <select id="status" onchange="toggleDebtInput()">
        <option value="paid">–û–ü–õ–ê–ß–ï–ù–û ‚úÖ</option>
        <option value="debt">–ë–û–†–ì üö©</option>
    </select>

    <div id="debtorBox" style="display: none; margin-top: 10px;">
        <label>–•—Ç–æ –≤–∏–Ω–µ–Ω?</label>
        <input type="text" id="debtorName" placeholder="–Ü–º'—è">
    </div>

    <label>–û–ø–ª–∞—Ç–∞</label>
    <select id="pay" onchange="calc()">
        <option value="–ì–æ—Ç—ñ–≤–∫–∞">–ì–æ—Ç—ñ–≤–∫–∞ (PLN)</option>
        <option value="–ü–æ–ª—å—Å—å–∫–∞ –∫–∞—Ä—Ç–∞">–ü–æ–ª—å—Å—å–∫–∞ –∫–∞—Ä—Ç–∞ (PLN)</option>
        <option value="–ú–æ–Ω–æ–±–∞–Ω–∫">–ú–æ–Ω–æ–±–∞–Ω–∫ (UAH)</option>
    </select>

    <div id="volBox">
        <label>–û–±'—î–º</label>
        <select id="size" onchange="calc()">
            <option value="2">2 ml</option>
            <option value="3">3 ml</option>
        </select>
    </div>

    <label>–°–º–∞–∫</label>
    <select id="flavor" onchange="handleFlavorChange()"></select>
    
    <div id="location-info">üìç –ú—ñ—Å—Ü–µ: <span id="loc-text">-</span></div>

    <label>–°–≤–æ—è —Ü—ñ–Ω–∞ (—è–∫—â–æ —Ç—Ä–µ–±–∞ –∑–º—ñ–Ω–∏—Ç–∏)</label>
    <input type="number" id="manualPrice" placeholder="–í–≤–µ–¥—ñ—Ç—å —á–∏—Å–ª–æ" oninput="calc()">

    <div class="price-display" id="total">6 –∑–ª</div>
    
    <button class="main-btn" onclick="saveOrder()">–ó–ë–ï–†–ï–ì–¢–ò</button>
</div>

<div class="table-card">
    <div class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ñ —Å–º–∞–∫–∏ üî•</div>
    <div id="topFlavors" class="top-badge"></div>

    <div class="section-title">–ë–æ—Ä–∂–Ω–∏–∫–∏ üö©</div>
    <div id="debtList"></div>

    <div class="section-title">–û—Å—Ç–∞–Ω–Ω—ñ –ø—Ä–æ–¥–∞–∂—ñ ‚úÖ</div>
    <div id="logs"></div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyAOW2GEW1McWRAzs4RLVOGHvcoAnRhgRC4",
      authDomain: "smokehub-7a072.firebaseapp.com",
      projectId: "smokehub-7a072",
      storageBucket: "smokehub-7a072.firebasestorage.app",
      messagingSenderId: "563107040578",
      appId: "1:563107040578:web:6379a7bc43bb7b58794cdb"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const allFlavors = [
        "–ë–ï–ó –°–ú–ê–ö–£", "spermint", "double grape", "apple mixed", "berry mint", 
        "blackurant grape", "blueberry curant", "watermelon melon", 
        "cranberry mors", "double raspberry", "Cola Lemon", 
        "RedBull blue raspberry", "pineaple lemonade", "multifruit", "bali triple shot"
    ];

    const locations = {
        "ICE SHOT": "–ê–ø—Ç–µ—á–∫–∞ —Å–∏–Ω—è",
        "spermint": "—à–∞—Ñ–∞ —á–æ—Ä–Ω–∞ –∫—É—Ä—Ç–∫–∞", "double grape": "–∑–ª—ñ–≤–∞ –ª—ñ–∂–∫–æ –¥–∞–Ω—ñ", "apple mixed": "—à–∞—Ñ–∞ —á–æ—Ä–Ω–∞ –∫—É—Ä—Ç–∫–∞",
        "berry mint": "—Å–ø—Ä–∞–≤–∞ –¥–∞–Ω—ñ –ª—ñ–∂–∫–æ", "blackurant grape": "—à–∞—Ñ–∞ –∑–≤–µ—Ä—Ö—É –¥–∞–Ω—è", "blueberry curant": "—Å–ø—Ä–∞–≤–∞ –¥–∞–Ω—ñ –ª—ñ–∂–∫–æ",
        "watermelon melon": "—à–∞—Ñ–∞ –∑–≤–µ—Ä—Ö—É –¥–∞–Ω—ñ", "cranberry mors": "—à–∞—Ñ–∞ —á–æ—Ä–Ω–∞ –∫—É—Ä—Ç–∫–∞", "double raspberry": "—à–∞—Ñ–∞ —á–æ—Ä–Ω–∞ –∫—É—Ä—Ç–∫–∞",
        "Cola Lemon": "—à–∞—Ñ–∞ –∑–≤–µ—Ä—Ö—É –æ–ª–µ–≥", "RedBull blue raspberry": "–∑–ª—ñ–≤–∞ –¥–∞–Ω—ñ –ª—ñ–∂–∫–æ", 
        "pineaple lemonade": "—à–∞—Ñ–∞ —á–æ—Ä–Ω–∞ –∫—É—Ä—Ç–∫–∞", "multifruit": "–≤ –ø–∞–∫–µ—Ç—ñ –≤ —à–∞—Ñ—ñ –¥–∞–Ω—ñ", "bali triple shot": "–≤ –ø–∞–∫–µ—Ç—ñ –≤ —à–∞—Ñ—ñ –¥–∞–Ω—ñ"
    };

    function updateFlavorList() {
        const catalog = document.getElementById('catalog').value;
        const flavorSelect = document.getElementById('flavor');
        const volBox = document.getElementById('volBox');
        
        flavorSelect.innerHTML = '<option value="none" selected disabled>–í–∏–±–µ—Ä–∏ —Å–º–∞–∫...</option>';
        
        if (catalog === "–∑–∞–ª–∏–≤–∫–∞") {
            allFlavors.forEach(f => { 
                flavorSelect.innerHTML += `<option value="${f}">${f}</option>`; 
            });
            volBox.style.display = "block";
        } else {
            flavorSelect.innerHTML += `<option value="ICE SHOT">ICE SHOT üßä</option>`;
            allFlavors.forEach(f => { 
                if (f === "–ë–ï–ó –°–ú–ê–ö–£") return;
                flavorSelect.innerHTML += `<option value="${f} (30ml)">${f} (30ml)</option>`; 
            });
            volBox.style.display = "none";
        }
        calc();
    }

    function handleFlavorChange() {
        const f = document.getElementById('flavor').value;
        const box = document.getElementById('location-info');
        const cleanName = f ? f.replace(" (30ml)", "") : "";
        if(locations[cleanName]) { 
            box.style.display="block"; 
            document.getElementById('loc-text').innerText = locations[cleanName]; 
        } else { box.style.display="none"; }
        calc();
    }

    function toggleDebtInput() { document.getElementById('debtorBox').style.display = (document.getElementById('status').value === 'debt') ? 'block' : 'none'; }

    function calc() {
        const cat = document.getElementById('catalog').value;
        const p = document.getElementById('pay').value;
        const s = document.getElementById('size').value;
        const f = document.getElementById('flavor').value;
        const manual = document.getElementById('manualPrice').value;
        const out = document.getElementById('total');
        
        let currency = (p === "–ú–æ–Ω–æ–±–∞–Ω–∫") ? "–≥—Ä–Ω" : "–∑–ª";
        let finalPrice = 0;

        if (manual && manual > 0) {
            finalPrice = manual;
        } else {
            if (cat === "–ø—Ä–æ–¥–∞–∂") {
                finalPrice = (f === "ICE SHOT") ? (p === "–ú–æ–Ω–æ–±–∞–Ω–∫" ? 180 : 15) : (p === "–ú–æ–Ω–æ–±–∞–Ω–∫" ? 650 : 60);
            } else {
                finalPrice = (p === "–ú–æ–Ω–æ–±–∞–Ω–∫") ? (s === "2" ? 70 : 100) : (s === "2" ? 6 : 9);
            }
        }
        
        out.innerText = `${finalPrice} ${currency}`;
    }

    async function saveOrder() {
        const f = document.getElementById('flavor').value;
        if(!f || f === "none") return alert("–í–∏–±–µ—Ä–∏ —Å–º–∞–∫!");
        const stat = document.getElementById('status').value;
        const dbtr = document.getElementById('debtorName').value;
        if(stat === 'debt' && !dbtr) return alert("–í–ø–∏—à–∏ —ñ–º'—è –±–æ—Ä–∂–Ω–∏–∫–∞!");
        const priceText = document.getElementById('total').innerText;
        
        try {
            await db.collection("orders").add({
                catalog: document.getElementById('catalog').value,
                pay: document.getElementById('pay').value,
                size: (document.getElementById('catalog').value === "–ø—Ä–æ–¥–∞–∂") ? (f === "ICE SHOT" ? "Shot" : "30ml") : document.getElementById('size').value + "ml",
                flavor: f, 
                priceVal: parseInt(priceText), 
                currency: (priceText.includes("–≥—Ä–Ω") ? "UAH" : "PLN"),
                fullPrice: priceText, 
                status: stat, 
                debtor: dbtr || "", 
                date: new Date().getTime()
            });
            document.getElementById('debtorName').value = "";
            document.getElementById('manualPrice').value = "";
            alert("–ó–±–µ—Ä–µ–∂–µ–Ω–æ! ‚úÖ");
        } catch (e) {
            alert("–ü–æ–º–∏–ª–∫–∞: " + e.message);
        }
    }

    function syncData() {
        db.collection("orders").orderBy("date", "desc").onSnapshot(snap => {
            const logs = document.getElementById('logs');
            const debtList = document.getElementById('debtList');
            const topBlock = document.getElementById('topFlavors');
            
            let pln = 0, uah = 0;
            let stats = {}; 
            
            logs.innerHTML = ""; 
            debtList.innerHTML = "";
            
            snap.forEach(doc => {
                const item = doc.data(); 
                const id = doc.id;
                
                const d = new Date(item.date);
                const dateStr = d.getDate().toString().padStart(2, '0') + '.' + (d.getMonth() + 1).toString().padStart(2, '0');
                
                if (item.status === 'paid') {
                    if(item.currency === "PLN") pln += item.priceVal; else uah += item.priceVal;
                    
                    if(item.flavor && item.flavor !== "–ë–ï–ó –°–ú–ê–ö–£") {
                        stats[item.flavor] = (stats[item.flavor] || 0) + 1;
                    }

                    logs.innerHTML += `
                    <div class="order-row">
                        <div class="order-info"><b>${item.flavor}</b><span>${item.size} ‚Ä¢ ${item.pay} ‚Ä¢ <i style="color:#00f2ff">${dateStr}</i></span></div>
                        <div class="order-right">
                            <div class="order-price">${item.fullPrice}</div>
                            <button class="action-btn" onclick="if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∑–∞–ø–∏—Å?')) db.collection('orders').doc('${id}').delete()">üóëÔ∏è</button>
                        </div>
                    </div>`;
                } else {
                    debtList.innerHTML += `
                    <div class="order-row debt">
                        <div class="order-info"><b>${item.debtor}</b><span>${item.flavor} ‚Ä¢ <i style="color:#ff9800">${dateStr}</i></span></div>
                        <div class="order-right">
                            <div class="order-price">${item.fullPrice}</div>
                            <button class="pay-debt-btn" onclick="db.collection('orders').doc('${id}').update({status:'paid'})">–û–ü–õ–ê–¢–ò–í</button>
                            <button class="action-btn" onclick="if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –±–æ—Ä–≥?')) db.collection('orders').doc('${id}').delete()">üóëÔ∏è</button>
                        </div>
                    </div>`;
                }
            });

            document.getElementById('totalPLN').innerText = pln;
            document.getElementById('totalUAH').innerText = uah;

            if (topBlock) {
                const sorted = Object.entries(stats).sort((a, b) => b[1] - a[1]).slice(0, 3);
                topBlock.innerHTML = sorted.length ? "" : "<div style='font-size:10px; color:#666; text-align:center;'>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–±–∏—Ä–∞—î—Ç—å—Å—è...</div>";
                sorted.forEach((item, index) => {
                    topBlock.innerHTML += `
                    <div class="top-item" style="display:flex; justify-content:space-between; font-size:13px; margin:5px 0; color:#ffd700;">
                        <span>${index + 1}. ${item[0]}</span>
                        <b>${item[1]} —à—Ç.</b>
                    </div>`;
                });
            }
        });
    }

    syncData();
    updateFlavorList();

    snap.forEach(doc=>{
        const v = doc.data();
        let d = "-";
        if(v.time){
            if(typeof v.time.toDate === "function"){
                d = v.time.toDate().toLocaleString();
            } else if(v.time.seconds){
                d = new Date(v.time.seconds*1000).toLocaleString();
            }
        }

        box.innerHTML += `
            <div class="visitor-card">
                <b>ID:</b> ${v.visitorId}<br>
                <span>–°—Ç–æ—Ä—ñ–Ω–∫–∞: ${v.page}</span>
                <span>–ú–æ–≤–∞: ${v.language}</span>
                <span>–ï–∫—Ä–∞–Ω: ${v.screen}</span>
                <span>–ß–∞—Å: ${d}</span>
            </div>
        `;
    });
});


</script>

    <div id="visitorsMenu" style="
    position:fixed;
    inset:0;
    background:radial-gradient(circle at top,#0f1c2e,#050914);
    z-index:9999;
    display:none;
    flex-direction:column;
    padding:20px;
    overflow-y:auto;
">

    <button onclick="closeVisitors()" style="
        background:#222;
        color:#fff;
        border:1px solid #555;
        padding:10px 15px;
        border-radius:12px;
        margin-bottom:15px;
        font-weight:bold;">
        ‚Üê –ù–∞–∑–∞–¥
    </button>

    <h2 style="color:#00f2ff; text-align:center; margin:10px 0 20px;">
        üëÅ –í—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ
    </h2>

    <div id="visitorsList"></div>
</div>

</body>
</html>
